<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¢u T√¥m T√≠ch</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="app">
        <!-- TomTich UI - Game c√¢u t√¥m t√≠ch (Vertical) -->
        <div v-if="tomtichVisible" id="tomtich-container">
            <!-- Main Game Wrapper - Hidden during tunnel phase -->
            <div v-if="gamePhase !== 'TUNNEL_NAV'" class="tomtich-wrapper">
                <!-- Header Bar for Phase 2 -->
                <div v-if="gamePhase !== 'IDLE'" class="game-header-bar">
                    <div class="game-title-header">ü¶û C√ÇU T√îM T√çCH - GIAI ƒêO·∫†N 2</div>
                    <button @click="handleTomTichClose" class="game-close-btn-header">‚úñ</button>
                </div>
                
                <!-- Close button for IDLE phase only -->
                <button v-if="gamePhase === 'IDLE'" @click="handleTomTichClose" class="tomtich-close-btn">‚úñ</button>

                <!-- Phase 1: Start Prompt -->
                <div v-if="gamePhase === 'IDLE'" class="start-prompt">
                    <div class="game-title">ü¶û C√ÇU T√îM T√çCH</div>
                    <div class="player-level-badge">LEVEL {{ playerLevel }}</div>
                    <div v-if="!tunnelCompleted" class="phase-badge">GIAI ƒêO·∫†N 1</div>
                    <div v-else class="phase-badge-2">GIAI ƒêO·∫†N 2</div>
                    <div v-if="!tunnelCompleted" class="game-instructions">
                        <div class="instruction-step">
                            <span class="step-number">1</span>
                            <span class="step-text">ƒêi·ªÅu khi·ªÉn m√≥c c√¢u qua hang</span>
                        </div>
                        <div class="instruction-step">
                            <span class="step-number">2</span>
                            <span class="step-text">Th·∫£ d√¢y c√¢u xu·ªëng ƒë√°y</span>
                        </div>
                        <div class="instruction-step">
                            <span class="step-number">3</span>
                            <span class="step-text">Gi·ªØ l·ª±c cƒÉng ƒë·ªÉ c√¢u t√¥m</span>
                        </div>
                    </div>
                    <div v-else class="tunnel-completed-box">
                        <div class="completed-checkmark">‚úì</div>
                        <div class="completed-text-main">ƒê√£ qua hang th√†nh c√¥ng!</div>
                        <div class="next-step-text">Ti·∫øp theo: Th·∫£ d√¢y c√¢u xu·ªëng ƒë√°y</div>
                    </div>
                    <div class="start-button">{{ tunnelCompleted ? 'GI·ªÆ SPACE ƒê·ªÇ B·∫ÆT ƒê·∫¶U' : 'GI·ªÆ SPACE ƒê·ªÇ B·∫ÆT ƒê·∫¶U' }}</div>
                </div>

                <!-- Phase 2: Dropping Line -->
                <div v-if="gamePhase === 'DROPPING'" class="dropping-phase">
                    <div class="phase-indicator">
                        <span class="phase-icon">‚¨áÔ∏è</span>
                        <span class="phase-title">ƒêANG TH·∫¢ C√ÇU</span>
                    </div>
                    <div class="dropping-text">GI·ªÆ SPACE ƒê·ªÇ TH·∫¢ D√ÇY</div>
                    <div class="depth-indicator">
                        <div class="depth-bar">
                            <div class="depth-fill" :style="{ height: fishingLineHeight + '%' }"></div>
                        </div>
                        <span class="depth-text">{{ Math.round(fishingLineHeight) }}%</span>
                    </div>
                    <div class="hint-text">Nh·∫£ Space = D√¢y thu l·∫°i</div>
                </div>

                <div v-if="gamePhase === 'WAITING'" class="dropping-phase waiting-phase">
                    <div class="phase-indicator">
                        <span class="phase-icon">‚è≥</span>
                        <span class="phase-title">CH·ªú T√îM C·∫ÆN C√ÇU</span>
                    </div>
                    <div class="dropping-text pulse-text">...ƒêANG CH·ªú...</div>
                    <div class="subtitle">Ti·∫øp t·ª•c gi·ªØ Space</div>
                    <div class="waiting-dots">
                        <span class="dot"></span>
                        <span class="dot"></span>
                        <span class="dot"></span>
                    </div>
                </div>

                <div v-if="gamePhase === 'BITING'" class="dropping-phase item-biting">
                    <div class="phase-indicator urgent">
                        <span class="phase-icon">‚ö°</span>
                        <span class="phase-title">T√îM C·∫ÆN C√ÇU!</span>
                    </div>
                    <div class="dropping-text blink urgent-text">NH·∫¢ SPACE NGAY!</div>
                    <div class="subtitle urgent-subtitle">Ph·∫£n x·∫° nhanh!</div>
                    <div class="urgency-bar"></div>
                </div>

                <div class="tomtich-scene-vertical" :class="{ 'blur-bg': gamePhase === 'IDLE' }">
                    <!-- Result Popup Overlay (Enhanced) -->
                    <div v-if="gamePhase === 'RESULT'" class="tomtich-result-enhanced"
                        :class="{ 'result-success': tomtichResultSuccess, 'result-fail': !tomtichResultSuccess }">
                        <div class="result-icon-large">
                            {{ tomtichResultSuccess ? 'üéâ' : 'üò¢' }}
                        </div>
                        <div class="result-title">
                            {{ tomtichResultSuccess ? 'TH√ÄNH C√îNG!' : 'TH·∫§T B·∫†I!' }}
                        </div>
                        <div class="result-message">
                            {{ resultMessage }}
                        </div>
                        <div class="result-reward" v-if="tomtichResultSuccess">
                            <img :src="currentShrimpImage" class="reward-icon-img" alt="T√¥m t√≠ch">
                            <span class="reward-text">ƒê√£ nh·∫≠n ph·∫ßn th∆∞·ªüng!</span>
                        </div>
                    </div>

                    <!-- C√°t b√™n tr√°i -->
                    <div class="sand-left-vertical">
                        <div class="sand-decorations">
                            <span class="deco">üêö</span>
                            <span class="deco">‚≠ê</span>
                        </div>
                    </div>

                    <!-- Hang t√¥m t√≠ch ·ªü gi·ªØa (d·ªçc) -->
                    <div class="cave-vertical" :class="{ 'shake': shrimpPulling }">
                        <!-- D√¢y c√¢u - chi·ªÅu d√†i thay ƒë·ªïi theo l·ª±c cƒÉng -->
                        <div v-if="['FISHING', 'RESULT', 'DROPPING', 'WAITING', 'BITING'].includes(gamePhase)"
                            class="fishing-line-vertical" :style="{ height: fishingLineHeight + '%' }">
                            <div class="hook-vertical" :class="{ 'shake': gamePhase === 'BITING' }">üêö</div>
                        </div>

                        <!-- T√¥m t√≠ch - v·ªã tr√≠ thay ƒë·ªïi theo l·ª±c cƒÉng -->
                        <div v-if="gamePhase === 'FISHING'" class="shrimp-container"
                            :style="{ top: shrimpPosition + '%' }">
                            <img :src="currentShrimpImage" class="shrimp-icon-img" :class="{ 'pulling': shrimpPulling }" alt="T√¥m t√≠ch">
                        </div>

                        <!-- Hi·ªáu ·ª©ng t√¥m gi·∫≠t -->
                        <div v-if="shrimpPulling" class="pull-warning">‚ö†Ô∏è T√îM GI·∫¨T M·∫†NH!</div>

                        <!-- ƒê√°y hang -->
                        <div class="cave-bottom"></div>
                    </div>

                    <!-- C√°t b√™n ph·∫£i -->
                    <div class="sand-right-vertical">
                        <div class="sand-decorations">
                            <span class="deco">üåä</span>
                            <span class="deco">üêö</span>
                        </div>
                    </div>

                    <!-- Thanh l·ª±c cƒÉng b√™n ngo√†i c√°t ph·∫£i -->
                    <div class="timing-container-outside">
                        <div v-if="gamePhase === 'FISHING'" class="tension-bar-container">
                            <div class="tension-label">L·ª∞C CƒÇNG</div>
                            <div class="tension-bar">
                                <!-- V√πng nguy hi·ªÉm tr√™n (l·ª±c th·∫•p - t√¥m tho√°t) -->
                                <div class="tension-zone danger-low-top">
                                    <span class="zone-label">T√îM THO√ÅT</span>
                                </div>
                                <!-- V√πng an to√†n (xanh/v√†ng) -->
                                <div class="tension-zone safe-zone">
                                    <span class="zone-label">AN TO√ÄN</span>
                                </div>
                                <!-- V√πng nguy hi·ªÉm d∆∞·ªõi (l·ª±c cao - ƒë·ª©t d√¢y) -->
                                <div class="tension-zone danger-high-bottom">
                                    <span class="zone-label">ƒê·ª®T D√ÇY</span>
                                </div>
                                <!-- Thanh l·ª±c hi·ªán t·∫°i -->
                                <div class="tension-indicator" :style="{ top: tensionLevel + '%' }">
                                    <span class="indicator-arrow">‚óÄ</span>
                                    <span class="indicator-value">{{ Math.round(100 - tensionLevel) }}%</span>
                                    <span class="indicator-arrow">‚ñ∂</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- N√∫t ƒëi·ªÅu khi·ªÉn -->
                <div class="tomtich-controls">
                    <div v-if="gamePhase === 'FISHING'" class="control-instructions">
                        <div class="fishing-status-bar">
                            <div class="status-item">
                                <span class="status-icon">‚è±Ô∏è</span>
                                <div class="status-content">
                                    <span class="status-label">Th·ªùi gian</span>
                                    <span class="status-value" :class="{ 'time-warning': timeRemaining <= 5 }">
                                        {{ Math.ceil(timeRemaining) }}s
                                    </span>
                                </div>
                            </div>
                            <div class="status-item">
                                <span class="status-icon">üéØ</span>
                                <div class="status-content">
                                    <span class="status-label">Ti·∫øn ƒë·ªô</span>
                                    <span class="status-value">{{ Math.round(catchProgress) }}%</span>
                                </div>
                            </div>
                        </div>

                        <div class="progress-bar-container">
                            <div class="progress-bar" :style="{ width: catchProgress + '%' }">
                                <span class="progress-shine"></span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- End of tomtich-wrapper -->

            <!-- Fishing Instructions Panel - Separate (Outside game container) -->
            <div v-if="gamePhase === 'FISHING'" class="fishing-instruction-panel-outside">
                <div class="instruction-header">
                    <span class="header-icon">üé£</span>
                    <h2>H∆Ø·ªöNG D·∫™N C√ÇU T√îM</h2>
                </div>
                <div class="instruction-content">
                    <div class="control-item">
                        <div class="control-icon">‚¨ÜÔ∏è</div>
                        <div class="control-desc">
                            <strong>Gi·ªØ SPACE</strong>
                            <span>K√©o d√¢y l√™n (TƒÉng l·ª±c)</span>
                        </div>
                    </div>
                    <div class="control-item">
                        <div class="control-icon">‚¨áÔ∏è</div>
                        <div class="control-desc">
                            <strong>Nh·∫£ SPACE</strong>
                            <span>Th·∫£ l·ªèng (Gi·∫£m l·ª±c)</span>
                        </div>
                    </div>
                    <div class="instruction-guide-text">
                        <div class="guide-icon">üí°</div>
                        <div class="guide-text">Gi·ªØ l·ª±c trong v√πng AN TO√ÄN ƒë·ªÉ c√¢u th√†nh c√¥ng!</div>
                    </div>
                </div>
            </div>

            <!-- Phase 1.5: Tunnel Navigation (Full Screen Overlay) -->
            <div v-if="gamePhase === 'TUNNEL_NAV'" id="tunnel-game-container">
                <!-- Header Bar with Title and Close Button -->
                <div class="tunnel-header-bar">
                    <div class="tunnel-title">GIAI ƒêO·∫†N 1: ƒêI QUA HANG</div>
                    <button @click="handleTomTichClose" class="tunnel-close-btn-header">‚úñ</button>
                </div>
                
                <canvas id="tunnelCanvas" ref="tunnelCanvas"></canvas>

                <!-- Bottom Info Panel - 3 rows -->
                <div class="tunnel-bottom-panel">
                    <!-- Row 1: Status Message (moved to top) -->
                    <div class="message-row">
                        <!-- Collision Warning -->
                        <div v-if="tunnelCollisionWarning" class="tunnel-status-message warning">
                            <div class="status-icon">‚ö†Ô∏è</div>
                            <div class="status-text">G·∫¶N T∆Ø·ªúNG!</div>
                        </div>

                        <!-- Main Message (Auto-hide after 1s) -->
                        <div v-else-if="tunnelMessage" class="tunnel-status-message" 
                             :class="{ 'success': tunnelMessage.includes('‚úÖ'), 'error': !tunnelMessage.includes('‚úÖ') }">
                            <div class="status-icon">{{ tunnelMessage.includes('‚úÖ') ? '‚úÖ' : '‚ö†Ô∏è' }}</div>
                            <div class="status-text">{{ tunnelMessage.replace('‚úÖ', '').trim() }}</div>
                        </div>
                    </div>

                    <!-- Row 2: Speed & Combo -->
                    <div class="info-row">
                        <!-- Speed Indicator -->
                        <div class="tunnel-speed-indicator">
                            <div class="speed-icon">‚ö°</div>
                            <div class="speed-content">
                                <div class="speed-label">T·ªêC ƒê·ªò</div>
                                <div class="speed-bar">
                                    <div class="speed-fill" :style="{ width: tunnelSpeed + '%' }"></div>
                                </div>
                            </div>
                            <div class="speed-value">{{ tunnelSpeed }}%</div>
                        </div>

                        <!-- Combo Counter -->
                        <div v-if="tunnelCombo > 0" class="tunnel-combo-indicator">
                            <div class="combo-icon">üî•</div>
                            <div class="combo-content">
                                <div class="combo-label">COMBO</div>
                                <div class="combo-value">x{{ tunnelCombo }}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Row 3: Horizontal Progress Bar -->
                    <div class="tunnel-progress-horizontal">
                        <div class="progress-label-left">ƒê·ªò S√ÇU</div>
                        <div class="progress-bar-horizontal">
                            <div class="progress-fill-horizontal" :style="{ width: tunnelProgress + '%' }"></div>
                        </div>
                        <div class="progress-value-right">{{ Math.round(tunnelProgress) }}%</div>
                    </div>
                </div>
            </div>

            <!-- Instructions Panel - Separate (Outside tunnel container) -->
            <div v-if="gamePhase === 'TUNNEL_NAV' && showTunnelInstruction" class="tunnel-instruction-panel-outside">
                <div class="instruction-header">
                    <span class="header-icon">üéØ</span>
                    <h2>GIAI ƒêO·∫†N 1: ƒêI QUA HANG</h2>
                </div>
                <div class="instruction-content">
                    <div class="control-item">
                        <div class="control-icon">üñ±Ô∏è</div>
                        <div class="control-desc">
                            <strong>Gi·ªØ chu·ªôt tr√°i</strong>
                            <span>Th·∫£ m√≥c c√¢u xu·ªëng</span>
                        </div>
                    </div>
                    <div class="control-item">
                        <div class="control-icon">‚ÜîÔ∏è</div>
                        <div class="control-desc">
                            <strong>Di chuy·ªÉn chu·ªôt</strong>
                            <span>ƒêi·ªÅu khi·ªÉn m√≥c n√© hang</span>
                        </div>
                    </div>
                    <div class="control-item">
                        <div class="control-icon">üéØ</div>
                        <div class="control-desc">
                            <strong>·ªû gi·ªØa ƒë∆∞·ªùng</strong>
                            <span>TƒÉng combo ƒëi·ªÉm</span>
                        </div>
                    </div>
                    <div class="warning-box">
                        <span class="warning-icon">‚ö†Ô∏è</span>
                        <span>ƒê·ª•ng hang = Thu d√¢y l·∫°i!</span>
                    </div>
                    <div class="instruction-guide-text">
                        <div class="guide-icon">üéØ</div>
                        <div class="guide-text">Gi·ªØ chu·ªôt tr√°i ƒë·ªÉ th·∫£ xu·ªëng - Di chuy·ªÉn chu·ªôt ƒë·ªÉ ƒëi·ªÅu khi·ªÉn</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Treasure Hunt UI - Mini Game ƒê√†o Kho B√°u -->
        <div v-if="treasureVisible" id="treasure-container">
            <div class="treasure-wrapper">
                <div class="treasure-header">
                    <div class="treasure-title">üíé ƒê√ÄO KHO B√ÅU</div>
                    <button @click="handleTreasureClose" class="treasure-close-btn">‚úñ</button>
                </div>

                <div class="treasure-info-bar">
                    <div class="info-item">
                        <span class="info-icon">üéØ</span>
                        <span class="info-label">L∆∞·ª£t c√≤n l·∫°i:</span>
                        <span class="info-value">{{ treasureAttempts }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-icon">üíé</span>
                        <span class="info-label">ƒê√£ t√¨m:</span>
                        <span class="info-value">{{ treasureFound }}/2</span>
                    </div>
                </div>

                <div class="treasure-grid">
                    <div 
                        v-for="(cell, index) in treasureCells" 
                        :key="index"
                        class="treasure-cell"
                        :class="{ 
                            'opened': cell.opened, 
                            'treasure': cell.isTreasure,
                            'trash': cell.opened && !cell.isTreasure,
                            'revealed': treasureGameEnded
                        }"
                        @click="openTreasureCell(index)"
                    >
                        <div class="cell-front">
                            <span class="card-icon">üé¥</span>
                        </div>
                        <div class="cell-back">
                            <span v-if="cell.isTreasure" class="treasure-icon">üíé</span>
                            <span v-else class="trash-icon">üóëÔ∏è</span>
                        </div>
                    </div>
                </div>

                <div v-if="treasureHint" class="treasure-hint">
                    <span class="hint-icon">üí°</span>
                    <span class="hint-text">{{ treasureHint }}</span>
                </div>

                <div v-if="treasureGameEnded && treasureResultMessage" class="treasure-result">
                    <div class="result-overlay" :class="{ 'win': treasureSuccess, 'lose': !treasureSuccess }">
                        <div class="result-icon">{{ treasureSuccess ? 'üéâ' : 'üò¢' }}</div>
                        <div class="result-title">{{ treasureSuccess ? 'TH√ÄNH C√îNG!' : 'TH·∫§T B·∫†I!' }}</div>
                        <div class="result-message">{{ treasureResultMessage }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Force reload by adding version query -->
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"></script>
    <script src="script.js"></script>
</body>

</html>